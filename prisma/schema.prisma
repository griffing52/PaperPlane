// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// Prisma Schema for Aviation Logbook System

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum UploadStatus {
  PENDING
  PROCESSING
  DONE
  FAILED
}

enum JobStatus {
  QUEUED
  RUNNING
  DONE
  ERRORED
  FAILED
}

enum FlightSource {
  OCR
  MANUAL
}

enum VerificationStatus {
  VERIFIED
  PARTIAL
  UNVERIFIED
}


// Models
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  pilot Pilot?

  @@map("users")
}

model Pilot {
  userId        String   @id
  licenseNumber String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  logbookUploads LogbookUpload[]
  flights        FlightEntry[]

  @@map("pilots")
}

model LogbookUpload {
  id             String       @id @default(uuid())
  pilotId        String
  filePath       String       // or storage URL
  status         UploadStatus @default(PENDING)
  time DateTime?
  errorMessage   String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  pilot   Pilot     @relation(fields: [pilotId], references: [userId], onDelete: Cascade)

  // TODO: What are the units?
  // ocrConfidence  Float?
  source         FlightSource
  flights        FlightEntry[]
}


model FlightEntry {
  id                 String       @id @default(uuid())
  pilotId            String
  uploadId           String?
  departureAirfield  String
  tailNumber         String
  depDate            String
  hours              Decimal
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  pilot              Pilot                 @relation(fields: [pilotId], references: [userId], onDelete: Cascade)
  upload             LogbookUpload?        @relation(fields: [uploadId], references: [id])
  // verificationResult VerificationResult?

  @@map("flight_entries")
}

// model VerificationResult {
//   id               String             @id @default(uuid())
//   entryId          String             @unique
//   status           VerificationStatus
//   score            Float
//   reasonForFail    String?
//   matchedHours     Decimal?
//   notes            String?
//   createdAt        DateTime           @default(now())
//   updatedAt        DateTime           @updatedAt
  
//   entry FlightEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)

//   @@map("verification_results")
// }
