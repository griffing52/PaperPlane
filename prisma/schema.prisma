// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// Prisma Schema for Aviation Logbook System

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum UploadStatus {
  PENDING
  PROCESSING
  DONE
  FAILED
}

enum JobStatus {
  QUEUED
  RUNNING
  DONE
  ERRORED
  FAILED
}

enum FlightSource {
  OCR
  MANUAL
}

enum VerificationStatus {
  VERIFIED
  PARTIAL
  UNVERIFIED
}


// Models
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  licenseNumber String   @unique
  flights        FlightLog[]

  @@map("users")
}

model Flight {
  id                      String        @id @default(uuid())
  tailNumber              String        @map("tail_number")
  aircraftModel           String        @map("aircraft_model")
  manufacturer            String
  originAirportIcao       String        @map("origin_airport_icao")
  destinationAirportIcao  String        @map("destination_airport_icao")
  departureTime           DateTime      @map("departure_time")
  arrivalTime             DateTime      @map("arrival_time")
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  
  // Relations
  flightEntries           FlightLog[]
  
  @@map("flights")
}

model FlightLog {
  id                 String       @id @default(uuid())
  flightId           String?       @map("flight_id")
  userId            String       @map("user_id")
  uploadId           String?      @map("upload_id")
  logbookURL         String?      @map("logbook_url")

  // Flight time categories - for student pilots
  totalFlightTime           Decimal  @default(0)  // Total duration of this flight
  soloTime                  Decimal  @default(0)  // Solo (student pilot)
  dualReceivedTime          Decimal  @default(0)  // Training with instructor

  // Special conditions - required for ratings
  crossCountryTime          Decimal  @default(0)  // XC (>50nm + landing elsewhere)
  nightTime                 Decimal  @default(0)  // Night (civil twilight to twilight)
  actualInstrumentTime      Decimal  @default(0)  // Actual IMC
  simulatedInstrumentTime   Decimal  @default(0)  // Hood/foggles

  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  flight             Flight?       @relation(fields: [flightId], references: [id], onDelete: Cascade)
  user               User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("flight_entries")
}

// model VerificationResult {
//   id               String             @id @default(uuid())
//   entryId          String             @unique
//   status           VerificationStatus
//   score            Float
//   reasonForFail    String?
//   matchedHours     Decimal?
//   notes            String?
//   createdAt        DateTime           @default(now())
//   updatedAt        DateTime           @updatedAt
  
//   entry FlightEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)

//   @@map("verification_results")
// }
